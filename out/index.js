var T=()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",r=e.length;for(let i=0;i<10;i++)t+=e.charAt(Math.floor(Math.random()*r));return t},D=T(),S=e=>{D=e};var v=e=>e.map(t=>JSON.stringify(Object.hasOwn(t,"get")&&t.get())).join("");var g=e=>{let t="",r=!1,i={},o=n=>{},d=()=>{let n=document.querySelector(`[data-nice-id="${t}"]`);!n||r||(r=!0,setTimeout(()=>{let a=o(t);a&&n.replaceWith(a.children[0]),r=!1},0))};return n=>(t=T(),S(t),i=n??{},o=e(i),{id:t,type:"component",properties:n,render:o,markDirty:d})};var j=(e,t)=>{let r=g(e)();if(t&&typeof window<"u"){let i=t?document.querySelector(t):void 0;if(!i)throw new Error(`Failed to attach - Element "${t}" not found in the DOM.`);r.markDirty=()=>{let o=r.render(T());if(o){for(;i.firstChild;)i.removeChild(i.firstChild);window?Array.from(o.hydrate().children).forEach(d=>{i.appendChild(d)}):i.innerHTML=o.html}},r.markDirty()}else return{html:r.render("nice-app-root").html,id:"nice-app-root",hydrate:i=>{let o=document.querySelector(`#${i}`);if(!o)throw new Error(`Failed to attach - Element "${t}" not found in the DOM.`);r.markDirty=()=>{let d=r.render(T());if(d){for(;o.firstChild;)o.removeChild(o.firstChild);window?Array.from(d.hydrate().children).forEach(c=>{o.appendChild(c)}):o.innerHTML=d.html}},r.markDirty()}}};var k=(e,...t)=>o=>{let d=`<!-- ${o} BEGIN -->`,c=`<!-- ${o} END -->`,n="",a={},l={};return e.forEach((p,m)=>{let s=t[m];if(n+=p,s===void 0)return;let f=Math.random().toString(36).substring(7);if(typeof s!="object"){n+=s;return}switch(s.type){case"component":n+=f,a[f]=s.render(s.id);break;case"state":n+=f,l[f]=s;break}}),Object.keys(a).forEach(p=>{n=n.replace(p,a[p].html.replace(/(<.+)( )/,`$1 data-reattach-child="${p}" `))}),Object.keys(l).forEach(p=>{let m=n.split(p)[0],s=O(m),f=l[p].get(),h=f;if(f)if(typeof f=="object"&&f.type==="component"){let y=f;h=y.render(y.id).html}else Array.isArray(f)&&(h=f.map(y=>{if(typeof y=="object"&&y.type==="component"){let u=y;return u.render(u.id).html}else return y}).join(""));let b=s?`state-${p}`:`<!-- @ --><span data-reattach-state="${p}" data-reattach-extras="${!!f}"></span>${h}<!-- # -->`;n=n.replace(p,b)}),{html:n,hydrate:()=>{let p=M(n);return p.children[0].setAttribute("data-nice-id",o),Object.keys(l).forEach(m=>{p.querySelectorAll(`[data-reattach-state="${m}"]`).forEach(s=>{s.getAttribute("data-reattach-extras")==="true"&&s.nextSibling?.remove();let h=l[m].get();l[m].markers.push([s.previousSibling,s.nextSibling]),w(h,s.previousSibling,s.nextSibling)})}),Object.keys(a).forEach(m=>{p.querySelectorAll(`[data-reattach-child="${m}"]`).forEach(s=>{s.replaceWith(a[m].hydrate().children[0])})}),p.querySelectorAll("*").forEach(m=>{Array.from(m.attributes).forEach(s=>{let f=s.name.startsWith("on-"),h=s.name.startsWith("set-"),b=s.name==="ref",y=s.value.match(/state-(.+)/);if(y){let u=l[y[1]];if(!u)return;u.attributes[s.name]||(u.attributes[s.name]=[]),f?(m.removeAttribute(s.name),m.addEventListener(s.name.slice(3),C=>u.set(C))):h?(m.removeAttribute(s.name),u.listen(C=>{m[s.name.slice(4)]=C}),m[s.name.slice(4)]=u.get()):b?(m.removeAttribute(s.name),u.set(m)):(u.attributes[s.name].push(m),m.setAttribute(s.name,u.get()??""))}})}),p}}},w=(e,t,r)=>{let i=[],o=t.nextSibling;for(;o!==r;)i.push(o),o=o?.nextSibling;if(e&&typeof e=="object"&&e.type==="component"){let d=e,c=d.render(d.id);i.forEach(n=>n.remove()),c&&Array.from(c.hydrate().children).reverse().forEach(n=>t.after(n))}else{let c=(Array.isArray(e)?e:[e]).map(n=>{if(typeof n=="object"&&n.type==="component"){let a=n;return a.render(a.id).hydrate()}else return n});i.forEach(n=>n.remove()),c.reverse().forEach(n=>{if(n instanceof HTMLElement)Array.from(n.children).reverse().forEach(a=>t.after(a));else{let a=document.createTextNode(n);t.after(a)}})}},M=e=>{let t=document.createElement("div");return t.innerHTML=e,t},O=e=>{let t=/.+\b(.+)="?$/gm,r,i=[];for(;(r=t.exec(e))!==null;)r.index===t.lastIndex&&t.lastIndex++,r.forEach(o=>{i.push(o)});if(i.length===2)return i[1]};var N=e=>{let t=e,r=T(),i=[],o=[],d=[],c={};return{id:r,type:"state",get:()=>t,set:n=>{let a=t;typeof e=="function"?a=n(t):a=n,a!==t&&(t=a,i.forEach(l=>l(a)),Object.entries(c).forEach(([l,x])=>{x.forEach(p=>{p.setAttribute(l,a??"")})}),d.forEach(([l,x])=>{w(t,l,x)}))},listen:n=>i.push(n),textNodes:o,markers:d,attributes:c}},E=(e,t)=>{let r=N(void 0),i=void 0,o=(t??[]).map(c=>c&&typeof c=="object"&&Object.hasOwn(c,"listen")?c:!1).filter(Boolean),d=c=>{let n=!!c&&!t,a=e(c),l=v(o);a!==r.get()&&l!==i&&!n&&r.set(a)};return t?(o.forEach(c=>c.listen(d)),d()):r.listen(d),r},A=e=>E(e||(()=>{}));var R=e=>{let t=Object.entries(e).reduce((r,[i,o])=>(r[i]=N(o),r),{});return[r=>t[r]]};var L=(e,t)=>{let r=[];return typeof e=="number"?r=Array.from({length:e},(i,o)=>o+1):typeof e=="object"?r=Array.from(Object.entries(e)):Array.isArray(e)&&(r=e),r.map((i,o)=>t(i,o))},I=e=>typeof e=="object"&&Object.hasOwn(e,"get")?e.get():e;var ae=N,ce=E,me=k,de=g,pe=A,fe=R,le=I,ue=typeof window<"u";export{j as app,de as component,ce as computed,ue as hasWindow,L as mapper,pe as ref,me as render,ae as state,fe as store,le as valueOf};
