var N=()=>{let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",r=t.length;for(let o=0;o<10;o++)e+=t.charAt(Math.floor(Math.random()*r));return e},D=N(),A=t=>{D=t};var v=t=>t.map(e=>JSON.stringify(Object.hasOwn(e,"get")&&e.get())).join(""),R=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();var E=t=>{let e="",r=!1,o={},i=s=>{},f=()=>{let s=document.querySelector(`[data-nice-id="${e}"]`);!s||r||(r=!0,setTimeout(()=>{let n=i(e);n&&s.replaceWith(n.children[0]),r=!1},0))};return(s,n)=>(e=N(),A(e),o=s??{},i=t(o,n),{id:e,type:"component",properties:s,render:i,markDirty:f,key:n??e})};var O=(t,e)=>{let r=E(t)();if(e&&typeof window<"u"){let o=e?document.querySelector(e):void 0;if(!o)throw new Error(`Failed to attach - Element "${e}" not found in the DOM.`);r.markDirty=()=>{let i=r.render(N());if(i){for(;o.firstChild;)o.removeChild(o.firstChild);window?Array.from(i.hydrate().children).forEach(f=>{o.appendChild(f)}):o.innerHTML=i.html}},r.markDirty()}else return{html:r.render("nice-app-root").html,id:"nice-app-root",hydrate:o=>{let i=document.querySelector(`#${o}`);if(!i)throw new Error(`Failed to attach - Element "${e}" not found in the DOM.`);r.markDirty=()=>{let f=r.render(N());if(f){for(;i.firstChild;)i.removeChild(i.firstChild);window?Array.from(f.hydrate().children).forEach(m=>{i.appendChild(m)}):i.innerHTML=f.html}},r.markDirty()}}};var M=(t,...e)=>i=>{let f=`<!-- ${i} BEGIN -->`,m=`<!-- ${i} END -->`,s="",n={},a={};t.forEach((p,l)=>{let d=e[l];if(s+=p,d===void 0)return;let u=I(p),c=Math.random().toString(36).substring(7);if(typeof d!="object"){u&&!p.endsWith('"')?s+=`"${d}"`:s+=d;return}switch(d.type){case"component":s+=c,n[c]=d.render(d.id);break;case"state":s+=c,a[c]=d;break}}),Object.keys(n).forEach(p=>{s=s.replace(p,n[p].html.replace(/(<.+)( )/,`$1 data-reattach-child="${p}" `))}),Object.keys(a).forEach(p=>{let l=s.split(p)[0],d=I(l),u=a[p].get(),c=u,g=1;if(u)if(typeof u=="object"&&u.type==="component"){let T=u;c=T.render(T.id).html}else Array.isArray(u)&&(g=u.length,c=u.map(T=>{if(typeof T=="object"&&T.type==="component"){let b=T;return b.render(b.id).html}else return T}).join(""));let k=d?`"${c||""}" data-bind-${d}="${p}"`:`<!-- @ --><span data-reattach-state="${p}" data-reattach-extras="${!!c&&g}"></span>${c}<!-- # -->`;s=s.replace(p,k)});let y=()=>{let p=H(s);return p.children[0].setAttribute("data-nice-id",i),Object.keys(a).forEach(l=>{p.querySelectorAll(`[data-reattach-state="${l}"]`).forEach(d=>{let u=d.getAttribute("data-reattach-extras");if(u&&u!=="false")for(let g=0;g<parseInt(u);g++)d.nextSibling?.remove();let c=a[l].get();a[l].markers.push([d.previousSibling,d.nextSibling]),w(c,d.previousSibling,d.nextSibling)})}),Object.keys(n).forEach(l=>{p.querySelectorAll(`[data-reattach-child="${l}"]`).forEach(d=>{d.replaceWith(n[l].hydrate().children[0])})}),p.querySelectorAll("*").forEach(l=>{Array.from(l.attributes).forEach(d=>{let u=d.name.match(/data-bind-(.+)$/);if(u){let c=u[1].trim(),g=d.value,k=c.startsWith("on-"),T=c.startsWith("set-"),b=c==="ref",h=a[g];if(!h)return;h.attributes[c]||(h.attributes[c]=[]),k?(l.removeAttribute(c),l.addEventListener(c.slice(3),C=>h.set(C))):T?(l.removeAttribute(c),h.listen(C=>{l[c.slice(4)]=C}),l[c.slice(4)]=h.get()):b?(l.removeAttribute(c),h.set(l)):(h.attributes[c].push(l),l.setAttribute(c,h.get()??"")),l.removeAttribute(d.name)}})}),p};return{html:s.trim(),hydrate:y}},w=(t,e,r)=>{let o=[],i=e.nextSibling;for(;i!==r;)o.push(i),i=i?.nextSibling;if(t&&typeof t=="object"&&t.type==="component"){let f=t,m=f.render(f.id);o.forEach(s=>s.remove()),m&&Array.from(m.hydrate().children).reverse().forEach(s=>e.after(s))}else{let f=Array.isArray(t)?t:[t],m=f.map(n=>{if(typeof n=="object"&&n.type==="component"){let a=n;return a.key??a.id}else return}).filter(n=>n!==void 0),s=f.map(n=>{if(typeof n=="object"&&n.type==="component"){console.log("RendernChild",n,n.properties);let a=n,y=a.render(a.id).hydrate();return y.children[0]&&n.key&&y.children[0].setAttribute("data-nice-key",n.key),console.log(y.children[0]),y}else return n});m.length?(o.forEach(n=>{m.includes(n.getAttribute("data-nice-key"))||n.remove()}),s.reverse().forEach(n=>{if(n instanceof HTMLElement){let a=null;Array.from(n.children).reverse().forEach(y=>{e.parentElement?.querySelector(`[data-nice-key="${y.getAttribute("data-nice-key")}"]`)||(a??r).before(y),a=y})}else{let a=document.createTextNode(n);e.after(a)}})):(o.forEach(n=>n.remove()),s.reverse().forEach(n=>{if(n instanceof HTMLElement)Array.from(n.children).reverse().forEach(a=>e.after(a));else{let a=document.createTextNode(n);e.after(a)}}))}},H=t=>{let e=document.createElement("div");return e.innerHTML=t,e},I=t=>{let e=/.+ (.+)="?$/gm,r,o=[];for(;(r=e.exec(t))!==null;)r.index===e.lastIndex&&e.lastIndex++,r.forEach(i=>{o.push(i)});if(o.length===2)return o[1]};var x=t=>{let e=t,r=N(),o=[],i=[],f=[],m={};return{id:r,type:"state",get:()=>e,set:s=>{let n=e;typeof t=="function"?n=s(e):n=s,n!==e&&(e=n,o.forEach(a=>a(n)),Object.entries(m).forEach(([a,y])=>{y.forEach(p=>{p.setAttribute(a,n??"")})}),f.forEach(([a,y])=>{w(e,a,y)}))},listen:s=>o.push(s),textNodes:i,markers:f,attributes:m}},S=(t,e)=>{let r=x(void 0),o=void 0,i=(e??[]).map(m=>m&&typeof m=="object"&&Object.hasOwn(m,"listen")?m:!1).filter(Boolean),f=m=>{let s=!!m&&!e,n=t(m),a=v(i);n!==r.get()&&a!==o&&!s&&r.set(n)};return e?(i.forEach(m=>m.listen(f)),f()):r.listen(f),r},j=t=>S(t||(()=>{}));var L=t=>{let e=Object.entries(t).reduce((r,[o,i])=>(r[o]=x(i),r),{});return r=>e[r]};var U=(t,e)=>{let r=[];return typeof t=="number"?r=Array.from({length:t},(o,i)=>i+1):typeof t=="object"?r=Array.from(Object.entries(t)):Array.isArray(t)&&(r=t),r.map((o,i)=>e(o,i))},$=t=>typeof t=="object"&&Object.hasOwn(t,"get")?t.get():t,P=t=>Object.entries(t).reduce((e,[r,o])=>`${e}${R(r)}: ${o};`,"");var le=x,fe=S,ue=M,ye=E,Te=j,he=L,Ne=$,ge=typeof window<"u";export{O as app,ye as component,fe as computed,ge as hasWindow,U as mapper,Te as ref,ue as render,le as state,he as store,P as styler,Ne as valueOf};
