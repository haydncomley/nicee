var y=()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",r=e.length;for(let s=0;s<10;s++)t+=e.charAt(Math.floor(Math.random()*r));return t},I=y(),C=e=>{I=e};var S=e=>e.map(t=>JSON.stringify(Object.hasOwn(t,"get")&&t.get())).join("");var h=e=>{let t="",r=!1,s={},i=n=>{},p=()=>{let n=document.querySelector(`[data-nice-id="${t}"]`);!n||r||(r=!0,setTimeout(()=>{let c=i(t);c&&n.replaceWith(c.children[0]),r=!1},0))};return n=>(t=y(),C(t),s=n??{},i=e(s),{id:t,type:"component",properties:n,render:i,markDirty:p})};var O=(e,t)=>{let r=document.querySelector(e);if(!r)throw new Error(`Failed to attach - Element "${e}" not found in the DOM.`);let s=h(t)();s.markDirty=()=>{let i=s.render(y());if(i){for(;r.firstChild;)r.removeChild(r.firstChild);Array.from(i.children).forEach(p=>{r.appendChild(p)})}},s.markDirty()};var v=(e,...t)=>i=>{let p=`<!-- ${i} BEGIN -->`,m=`<!-- ${i} END -->`,n="",c={},d={};e.forEach((o,a)=>{let f=t[a];if(n+=o,f===void 0)return;let T=Math.random().toString(36).substring(7);switch(f.type){case"component":n+=T,c[T]=f.render(f.id);break;case"state":n+=T,d[T]=f;break}}),Object.keys(c).forEach(o=>{n=n.replace(o,`<span data-reattach-child="${o}"></span>`)}),Object.keys(d).forEach(o=>{let a=n.split(o)[0],T=j(a)?`state-${o}`:`<!-- @ --><span data-reattach-state="${o}"></span><!-- # -->`;n=n.replace(o,T)});let l=M(n);return l.children[0].setAttribute("data-nice-id",i),Object.keys(d).forEach(o=>{l.querySelectorAll(`[data-reattach-state="${o}"]`).forEach(a=>{let f=d[o].get();d[o].markers.push([a.previousSibling,a.nextSibling]),g(f,a.previousSibling,a.nextSibling)})}),Object.keys(c).forEach(o=>{l.querySelectorAll(`[data-reattach-child="${o}"]`).forEach(a=>{a.replaceWith(c[o].children[0])})}),l.querySelectorAll("*").forEach(o=>{Array.from(o.attributes).forEach(a=>{let f=a.name.startsWith("on-"),T=a.name.startsWith("set-"),A=a.name==="ref",E=a.value.match(/state-(.+)/);if(E){let u=d[E[1]];if(!u)return;u.attributes[a.name]||(u.attributes[a.name]=[]),f?(o.removeAttribute(a.name),o.addEventListener(a.name.slice(3),x=>u.set(x))):T?(o.removeAttribute(a.name),u.listen(x=>{o[a.name.slice(4)]=x}),o[a.name.slice(4)]=u.get()):A?(o.removeAttribute(a.name),u.set(o)):(u.attributes[a.name].push(o),o.setAttribute(a.name,u.get()??""))}})}),l},g=(e,t,r)=>{let s=[],i=t.nextSibling;for(;i!==r;)s.push(i),i=i?.nextSibling;if(e&&typeof e=="object"&&e.type==="component"){let p=e,m=p.render(p.id);s.forEach(n=>n.remove()),m&&Array.from(m.children).reverse().forEach(n=>t.after(n))}else{let m=(Array.isArray(e)?e:[e]).map(n=>{if(typeof n=="object"&&n.type==="component"){let c=n;return c.render(c.id)}else return n});s.forEach(n=>n.remove()),m.reverse().forEach(n=>{if(n instanceof HTMLElement)Array.from(n.children).reverse().forEach(c=>t.after(c));else{let c=document.createTextNode(n);t.after(c)}})}},M=e=>{let t=document.createElement("div");return t.innerHTML=e,t},j=e=>{let t=/.+\b(.+)="?$/gm,r,s=[];for(;(r=t.exec(e))!==null;)r.index===t.lastIndex&&t.lastIndex++,r.forEach(i=>{s.push(i)});if(s.length===2)return s[1]};var N=e=>{let t=e,r=y(),s=[],i=[],p=[],m={};return{id:r,type:"state",get:()=>t,set:n=>{let c=t;typeof e=="function"?c=n(t):c=n,c!==t&&(t=c,s.forEach(d=>d(c)),Object.entries(m).forEach(([d,l])=>{l.forEach(o=>{o.setAttribute(d,c??"")})}),p.forEach(([d,l])=>{g(t,d,l)}))},listen:n=>s.push(n),textNodes:i,markers:p,attributes:m}},b=(e,t)=>{let r=N(void 0),s=void 0,i=(t??[]).map(m=>m&&typeof m=="object"&&Object.hasOwn(m,"listen")?m:!1).filter(Boolean),p=m=>{let n=!!m&&!t,c=e(m),d=S(i);c!==r.get()&&d!==s&&!n&&r.set(c)};return t?(i.forEach(m=>m.listen(p)),p()):r.listen(p),r},k=e=>b(e||(()=>{}));var R=e=>{let t=Object.entries(e).reduce((r,[s,i])=>(r[s]=N(i),r),{});return[r=>t[r]]};var D=(e,t)=>{let r=[];return typeof e=="number"?r=Array.from({length:e},(s,i)=>i+1):typeof e=="object"?r=Array.from(Object.entries(e)):Array.isArray(e)&&(r=e),r.map((s,i)=>t(s,i))},w=e=>typeof e=="object"&&Object.hasOwn(e,"get")?e.get():e;var ie=N,ae=b,ce=v,me=h,pe=k,de=R,fe=w;export{O as app,me as component,ae as computed,D as mapper,pe as ref,ce as render,ie as state,de as store,fe as valueOf};
