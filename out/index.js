var N=()=>{let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",r=t.length;for(let i=0;i<10;i++)e+=t.charAt(Math.floor(Math.random()*r));return e},O=N(),A=t=>{O=t};var v=t=>t.map(e=>JSON.stringify(Object.hasOwn(e,"get")&&e.get())).join(""),R=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();var x=t=>{let e="",r=!1,i={},s=o=>{},d=()=>{let o=document.querySelector(`[data-nice-id="${e}"]`);!o||r||(r=!0,setTimeout(()=>{let n=s(e);n&&o.replaceWith(n.children[0]),r=!1},0))};return(o,n)=>(e=N(),A(e),i=o??{},s=t(i,n),{id:e,type:"component",properties:o,render:s,markDirty:d,key:n??e})};var U=(t,e)=>{let r=x(t)();if(e&&typeof window<"u"){let i=e?document.querySelector(e):void 0;if(!i)throw new Error(`Failed to attach - Element "${e}" not found in the DOM.`);r.markDirty=()=>{let s=r.render(N());if(s){for(;i.firstChild;)i.removeChild(i.firstChild);window?Array.from(s.hydrate().children).forEach(d=>{i.appendChild(d)}):i.innerHTML=s.html}},r.markDirty()}else return{html:r.render("nice-app-root").html,id:"nice-app-root",hydrate:i=>{let s=document.querySelector(`#${i}`);if(!s)throw new Error(`Failed to attach - Element "${e}" not found in the DOM.`);r.markDirty=()=>{let d=r.render(N());if(d){for(;s.firstChild;)s.removeChild(s.firstChild);window?Array.from(d.hydrate().children).forEach(m=>{s.appendChild(m)}):s.innerHTML=d.html}},r.markDirty()}}};var M=(t,...e)=>s=>{let d=`<!-- ${s} BEGIN -->`,m=`<!-- ${s} END -->`,o="",n={},a={};t.forEach((l,f)=>{let p=e[f];if(o+=l,p===void 0)return;let u=I(l),c=Math.random().toString(36).substring(7);if(typeof p!="object"){u&&!l.endsWith('"')?o+=`"${p}"`:o+=p;return}switch(p.type){case"component":o+=c,n[c]=p.render(p.id);break;case"state":o+=c,a[c]=p;break}}),Object.keys(n).forEach(l=>{o=o.replace(l,n[l].html.replace(/(<.+)( )/,`$1 data-reattach-child="${l}" `))}),Object.keys(a).forEach(l=>{let f=o.split(l)[0],p=I(f),u=a[l].get(),c=u,g=1;if(u)if(typeof u=="object"&&u.type==="component"){let T=u;c=T.render(T.id).html}else Array.isArray(u)&&(g=u.length,c=u.map(T=>{if(typeof T=="object"&&T.type==="component"){let C=T;return C.render(C.id).html}else return T}).join(""));let E=p?`"${c||""}" data-bind-${p}="${l}"`:`<!-- @ -->${c}<span style="display: none;" data-reattach-state="${l}" data-reattach-extras="${!!c&&g}"></span><!-- # -->`;o=o.replace(l,E)});let y=()=>{let l=H(o);return l.children[0].setAttribute("data-nice-id",s),Object.keys(a).forEach(f=>{l.querySelectorAll(`[data-reattach-state="${f}"]`).forEach(p=>{let u=p.getAttribute("data-reattach-extras");if(u&&u!=="false")for(let g=0;g<parseInt(u);g++)p.previousSibling?.remove();let c=a[f].get();a[f].markers.push([p.previousSibling,p.nextSibling]),w(c,p.previousSibling,p.nextSibling)})}),Object.keys(n).forEach(f=>{l.querySelectorAll(`[data-reattach-child="${f}"]`).forEach(p=>{p.replaceWith(n[f].hydrate().children[0])})}),l.querySelectorAll("*").forEach(f=>{Array.from(f.attributes).forEach(p=>{let u=p.name.match(/data-bind-(.+)$/);if(u){let c=u[1].trim(),g=p.value,E=c.startsWith("on-"),T=c.startsWith("set-"),C=c==="ref",h=a[g];if(!h)return;h.attributes[c]||(h.attributes[c]=[]),E?(f.removeAttribute(c),f.addEventListener(c.slice(3),k=>h.set(k))):T?(f.removeAttribute(c),h.listen(k=>{f[c.slice(4)]=k}),f[c.slice(4)]=h.get()):C?(f.removeAttribute(c),h.set(f)):(h.attributes[c].push(f),f.setAttribute(c,h.get()??"")),f.removeAttribute(p.name)}})}),l};return{html:o.trim(),hydrate:y}},w=(t,e,r)=>{let i=[],s=e.nextSibling;for(;s!==r;)i.push(s),s=s?.nextSibling;if(t&&typeof t=="object"&&t.type==="component"){let d=t,m=d.render(d.id);i.forEach(o=>o.remove()),m&&Array.from(m.hydrate().children).reverse().forEach(o=>e.after(o))}else{let d=Array.isArray(t)?t:[t],m=d.map(n=>{if(typeof n=="object"&&n.type==="component"){let a=n;return a.key??a.id}else return}).filter(n=>n!==void 0),o=d.map(n=>{if(typeof n=="object"&&n.type==="component"){console.log("RendernChild",n,n.properties);let a=n,y=a.render(a.id).hydrate();return y.children[0]&&n.key&&y.children[0].setAttribute("data-nice-key",n.key),console.log(y.children[0]),y}else return n});m.length?(i.forEach(n=>{m.includes(n.getAttribute("data-nice-key"))||n.remove()}),o.reverse().forEach(n=>{if(n instanceof HTMLElement){let a=null;Array.from(n.children).reverse().forEach(y=>{e.parentElement?.querySelector(`[data-nice-key="${y.getAttribute("data-nice-key")}"]`)||(a??r).before(y),a=y})}else{let a=document.createTextNode(n);e.after(a)}})):(i.forEach(n=>n.remove()),o.reverse().forEach(n=>{if(n instanceof HTMLElement)Array.from(n.children).reverse().forEach(a=>e.after(a));else{let a=document.createTextNode(n);e.after(a)}}))}},H=t=>{let e=document.createElement("div");return e.innerHTML=t,e},I=t=>{let e=/.+ (.+)="?$/gm,r,i=[];for(;(r=e.exec(t))!==null;)r.index===e.lastIndex&&e.lastIndex++,r.forEach(s=>{i.push(s)});if(i.length===2)return i[1]};var b=t=>{let e=t,r=N(),i=[],s=[],d=[],m={};return{id:r,type:"state",get:()=>e,set:o=>{let n=e;typeof t=="function"?n=o(e):n=o,n!==e&&(e=n,i.forEach(a=>a(n)),Object.entries(m).forEach(([a,y])=>{y.forEach(l=>{l.setAttribute(a,n??"")})}),d.forEach(([a,y])=>{w(e,a,y)}))},listen:o=>i.push(o),textNodes:s,markers:d,attributes:m}},S=(t,e)=>{let r=b(void 0),i=void 0,s=(e??[]).map(m=>m&&typeof m=="object"&&Object.hasOwn(m,"listen")?m:!1).filter(Boolean),d=m=>{let o=!!m&&!e,n=t(m),a=v(s);n!==r.get()&&a!==i&&!o&&r.set(n)};return e?(s.forEach(m=>m.listen(d)),d()):r.listen(d),r},j=t=>S(t||(()=>{}));var L=t=>{let e=Object.entries(t).reduce((r,[i,s])=>(r[i]=b(s),r),{});return r=>e[r]};var P=(t,e)=>{let r=[];typeof t=="number"?r=Array.from({length:t},(d,m)=>m+1):Array.isArray(t)?r=[...t]:typeof t=="object"&&(r=Array.from(Object.entries(t)));let i=!1,s=r.map((d,m)=>{let o=e(d,m);return typeof o=="function"?(i=D,x(()=>o)()):o});return i?s.reverse():s},$=t=>typeof t=="object"&&Object.hasOwn(t,"get")?t.get():t,F=t=>Object.entries(t).reduce((e,[r,i])=>`${e}${R(r)}: ${i};`,"");var ye=b,Te=S,he=M,Ne=x,ge=j,xe=L,be=$,D=typeof window<"u";export{U as app,Ne as component,Te as computed,D as hasWindow,P as mapper,ge as ref,he as render,ye as state,xe as store,F as styler,be as valueOf};
